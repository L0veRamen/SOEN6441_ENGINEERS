# This is the main configuration file for the application.
# https://www.playframework.com/documentation/latest/ConfigFile
# ==================== APPLICATION ====================
play.application.name = "NotiLytics"

# ==================== PEKKO ACTOR SYSTEM (D2 NEW) ====================
pekko {
  # Actor system configuration
  actor {
    provider = "org.apache.pekko.actor.LocalActorRefProvider"

    # Default dispatcher for actors
    default-dispatcher {
      type = "Dispatcher"
      executor = "fork-join-executor"

      fork-join-executor {
        parallelism-min = 8
        parallelism-factor = 3.0
        parallelism-max = 64
      }

      throughput = 5
    }
  }

  # Logging configuration
  loglevel = "INFO"
  stdout-loglevel = "INFO"

  # Log dead letters (for debugging)
  log-dead-letters = 10
  log-dead-letters-during-shutdown = on

  # Stream configuration
  stream {
    materializer {
      initial-input-buffer-size = 4
      max-input-buffer-size = 16
    }
  }
}

# ==================== WEBSOCKET CONFIGURATION (D2 NEW) ====================
websocket {
  # Update interval for live searches (seconds)
  update-interval = 30

  # Max search history per session
  max-history = 10

  # Max URLs to track for deduplication
  max-seen-urls = 100

  # Supervision strategy
  supervision {
    max-retries = 3
    within-time-range = "1 minute"
  }
}

# ==================== NEWSAPI ====================
newsapi {
 key = "efa10d6cf8d043bba3c0f6f07a373e82"
  # key = "721974412ce842c49815b6be1e0f0182"
  baseUrl = "https://newsapi.org/v2"
  timeouts {
    connect = 3s
    read = 5s
  }
}

# ==================== HTTP SERVER ====================
play.server.http.port = 9000

# ==================== SESSION CONFIGURATION ====================
play.http.session {
  # Session cookie name
  cookieName = "NOTILYTICS_SESSION"

  # Maximum session age (1 hour)
  maxAge = 3600000

  # HTTP only (prevent JavaScript access)
  httpOnly = true

  # Secure flag (set to true in production with HTTPS)
  secure = false

  # SameSite policy
  sameSite = "lax"
}

# ==================== CACHING CONFIGURATION ====================
cache {
  ttl {
    search = 15m    # Search results cache TTL
    stats = 15m     # Word stats cache TTL
    sources = 60m   # News sources cache TTL
  }
  maxSize = 1000    # Max cache entries
}

# ==================== HISTORY CONFIGURATION (D1 - DEPRECATED) ====================\
# Note: History now managed in UserActor (in-memory)
history {
  ttl = 2h          # Session history TTL (idle timeout)
  maxSessions = 10000
}

# ==================== TIMEZONE ====================
app.timezone = "America/Toronto"

# ==================== SECURITY FILTERS ====================
play.filters.enabled += "play.filters.csrf.CSRFFilter"
play.filters.enabled += "play.filters.headers.SecurityHeadersFilter"
play.filters.enabled += "play.filters.hosts.AllowedHostsFilter"

# Allowed hosts
play.filters.hosts {
  allowed = ["localhost:9000", "127.0.0.1:9000"]
}

# CSRF Configuration
play.filters.csrf {
  cookie.name = "NOTILYTICS_CSRF"
  header.name = "X-CSRF-Token"
}

# Security Headers
play.filters.headers {
  contentSecurityPolicy = "default-src 'self' 'unsafe-inline' 'unsafe-eval'"
  frameOptions = "DENY"
  xssProtection = "1; mode=block"
  contentTypeOptions = "nosniff"
}

# ==================== GUICE MODULES ====================
play.modules.enabled += "modules.AppModule"
play.modules.enabled += "play.libs.ws.ahc.AhcWSModule"

# ==================== LOGGING ====================
logger.root = WARN
logger.play = INFO
logger.application = DEBUG
logger.controllers = DEBUG
logger.services = DEBUG
logger.actors = DEBUG

# Don't log API keys
logger.services.NewsApiClient = INFO